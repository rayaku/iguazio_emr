# The docker expects to find in the path /home/iguazio/.aws two files:
# - credentials
# - config 
# previously generated by procedure described here : http://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html
# 
#
# the second volume should mount the emr_install directory with scripts and configuration.
# this docker created for running following remote commands on emr cluster:
# - /start_cluster.sh
# - /home/iguazio/run_spark_job.sh
# - /terminate-emr-cluster.sh
# 
#example: how to run this docker 
#docker run \
#       --detach \
#       --name start_emr_cluster \
#       --volume $PWD/AWS/EMR/emr_install/emr-5.6.0:/emr_install \
#       --volume /home/iguazio/.aws:/home/iguazio/.aws \
#       --volume /tmp:/tmp \
#       artifactory.iguazeng.com:6555/emr-runner:latest /start_cluster.sh &

FROM artifactory.iguazeng.com:6555/ubuntu:16.04
	ARG DEBIAN_FRONTEND=noninteractive
        #
        # Variables
        ENV LC_ALL C
        ENV ART_URL               $art_url
        ENV VERSION               "$version"
        ENV HOME                  "/home/iguazio"

 #TODO change it for getting all debian packager from the local artifactory 
 #echo "deb http://USER:PASSWORD@artifactory.iguazeng.com:8081/artifactory/ubuntu_deb xenial main restricted" > /etc/apt/sources.list && \

RUN mkdir -p ${HOME}/.aws && \
	mkdir -p ${HOME}/config && \
  	apt-get update && \
	apt-get update && \
	apt-get install -qqy \
	curl \
	aptitude \
	apt-utils \
	python-dev \
	vim \
	ssh \
	python-pip

ADD start_cluster.sh /start_cluster.sh
ADD terminate-emr-cluster.sh /terminate-emr-cluster.sh
ADD run_spark_job.sh ${HOME}/run_spark_job.sh 

RUN apt-get clean && \
	chmod 755 /*.sh && \
	rm -rf /var/lib/apt/lists/* && \
	pip install --upgrade awscli && \
	pip install --upgrade pip
